stages:
  - release

release_notes:
  stage: release
  script:
    - echo "Token length:${#GITLAB_TOKEN}"
    - echo "ğŸ”¹ í˜„ì¬ íƒœê·¸:$CI_COMMIT_TAG"
    - LATEST_TAG=$CI_COMMIT_TAG
    - PREV_TAG=$(git tag --sort=-v:refname | awk -v latest="$LATEST_TAG" '$0 == latest {getline; print; exit}')
    - echo "ğŸ”¹ ì´ì „ íƒœê·¸:$PREV_TAG"
    - NOTES=$(git log --pretty=format:"- %s%n  %b (%an)" ${PREV_TAG}..${LATEST_TAG})
    - echo "ğŸ”¹ ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ ë‚´ìš©:\n$NOTES"
    - |
      curl --request POST --header "PRIVATE-TOKEN: $GITLAB_TOKEN" --data "name=$LATEST_TAG" --data "tag_name=$LATEST_TAG" --data "ref=$LATEST_TAG" --data "description=$NOTES" "https://gitlab.strato.co.kr/api/v4/projects/183/releases"
  rules:
    - if: $CI_COMMIT_TAG  # íƒœê·¸ê°€ ìƒì„±ë  ë•Œë§Œ ì‹¤í–‰
  tags:
    - release
